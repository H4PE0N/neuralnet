ROOT_FOLDER := ..

FILES_TARGET := files
CLEAN_TARGET := clean

RUNBLE_FILES = master dataset debug

COMPILE_FLAGS := -Wall -Werror -g -Og -std=c99
COMPILE_PRGRM := gcc
COMPILE_LINKS := -lm

DELETE_FLAGS :=
DELETE_COMND := rm

SOURCE_FOLDER := $(ROOT_FOLDER)/source
OBJECT_FOLDER := $(ROOT_FOLDER)/object
BINARY_FOLDER := $(ROOT_FOLDER)/binary

ENGINE_FOLDER := $(SOURCE_FOLDER)/engine
DATASET_FOLDER := $(SOURCE_FOLDER)/dataset
MASTER_FOLDER := $(SOURCE_FOLDER)/master

MODULE_SOURCE := source
MODULE_HEADER := header

ENGINE_SOURCE := $(ENGINE_FOLDER)/$(MODULE_SOURCE)
ENGINE_HEADER := $(ENGINE_FOLDER)/$(MODULE_HEADER)

DATASET_SOURCE := $(DATASET_FOLDER)/$(MODULE_SOURCE)
DATASET_HEADER := $(DATASET_FOLDER)/$(MODULE_HEADER)

ENGINE_SOURCES := $(wildcard $(ENGINE_SOURCE)/*.c)
ENGINE_HEADERS := $(wildcard $(ENGINE_HEADER)/*.h) $(ENGINE_FOLDER)/engine.h
ENGINE_OBJECTS := $(patsubst $(ENGINE_SOURCE)/%.c, $(OBJECT_FOLDER)/%.o, $(ENGINE_SOURCES))

DATASET_SOURCES := $(wildcard $(DATASET_SOURCE)/*.c)
DATASET_HEADERS := $(wildcard $(DATASET_HEADER)/*.h) $(DATASET_FOLDER)/dataset.h
DATASET_OBJECTS := $(patsubst $(DATASET_SOURCE)/%.c, $(OBJECT_FOLDER)/%.o, $(DATASET_SOURCES))

SOURCE_FILES := $(ENGINE_SOURCES) $(DATASET_SOURCES)
HEADER_FILES := $(ENGINE_HEADERS) $(DATASET_HEADERS)
OBJECT_FILES := $(ENGINE_OBJECTS) $(DATASET_OBJECTS)

default: $(RUNBLE_FILES)

$(RUNBLE_FILES): %: $(OBJECT_FOLDER)/%.o $(OBJECT_FILES) $(MASTER_FOLDER)/%.c $(SOURCE_FILES) $(HEADER_FILES)
	$(COMPILE_PRGRM) $(OBJECT_FOLDER)/$@.o $(OBJECT_FILES) $(COMPILE_FLAGS) $(COMPILE_LINKS) -o $@

$(OBJECT_FOLDER)/%.o: $(ENGINE_SOURCE)/%.c 
	$(COMPILE_PRGRM) $< -c $(COMPILE_FLAGS) -o $@

$(OBJECT_FOLDER)/%.o: $(DATASET_SOURCE)/%.c 
	$(COMPILE_PRGRM) $< -c $(COMPILE_FLAGS) -o $@

$(OBJECT_FOLDER)/%.o: $(MASTER_FOLDER)/%.c
	$(COMPILE_PRGRM) $< -c $(COMPILE_FLAGS) -o $@

.PRECIOUS: $(OBJECT_FILES) $(RUNBLE_FILES)

DELETE_FILES := $(OBJECT_FOLDER)/*.o $(RUNBLE_FILES)

$(FILES_TARGET):
	$(foreach RUNBLE_FILE, $(RUNBLE_FILES), $(info $(RUNBLE_FILE)))

$(CLEAN_TARGET):
	$(DELETE_COMND) $(DELETE_FLAGS) $(DELETE_FILES)
